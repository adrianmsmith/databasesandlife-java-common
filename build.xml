<!-- TODO: javadoc

-public -link http://java.sun.com/j2se/1.5.0/docs/api -link https://www.hibernate.org/hib_docs/v3/api -stylesheetfile C:\Adrian\data\dev\common\java\javadoc.css
  & @author @revision tags

-->


<project name="databasesandlife-util" basedir="." default="all">

  <property name="compile-into" location="build-tmp/java-classes"/>
  <property name="javadoc-into" location="build-tmp/javadoc"/>

  <target name="find-revision" description="Sets property 'revision.number' to the head svn revision">
    <echo>Finding Subversion revision number...</echo>
    <exec executable="svn" outputproperty="svn.info.output">
      <arg line="info"/>
    </exec>
    <exec executable="perl" inputstring="${svn.info.output}" outputproperty="svn.url">
      <arg value="-e"/>
      <arg value="while (&lt;>) { if (/URL: (.+)/) { print $1; exit; } }"/>
    </exec>
    <echo>Using SVN URL: ${svn.url}</echo>

    <exec executable="svn" outputproperty="svn.log.output">
      <arg line="log -q ${svn.url}"/>
    </exec>
    <exec executable="perl" inputstring="${svn.log.output}" outputproperty="revision.number">
      <arg value="-e"/>
      <arg value="while (&lt;>) { if (/^r(\d+)/) { print $1; exit; } }"/>
    </exec>
    <echo>Will use Subversion revision r${revision.number}</echo>
  </target>

  <target name="create-jar" depends="find-revision">
    <delete dir="${compile-into}"/> <!-- force a clean compile -->
    <mkdir dir="${compile-into}"/>
    <javac srcdir="src" destdir="${compile-into}" debug="on" deprecation="on">
      <compilerarg value="-Xlint:unchecked"/>
      <classpath>
        <fileset dir="lib-compile" includes="*.jar"/>
      </classpath> 
    </javac>
    <copy todir="${compile-into}">
      <fileset dir="src">
        <include name="**/*.properties"/>
        <include name="**/*.java"/>
      </fileset>
    </copy>
    <delete> <fileset dir="." includes="databasesandlife-util-incl-src-r*.jar"/> </delete>
    <jar jarfile="databasesandlife-util-incl-src-r${revision.number}.jar" basedir="${compile-into}"/>
  </target>

  <target name="create-javadoc">
    <javadoc
        sourcepath="src"
        destdir="${javadoc-into}"
        author="true"
        version="true"
        access="public"
        stylesheetfile="javadoc.css">
      <link href="http://java.sun.com/j2se/1.5.0/docs/api"/>
      <link href="https://www.hibernate.org/hib_docs/v3/api"/>
      <classpath>
        <fileset dir="lib-compile" includes="*.jar"/>
      </classpath>
    </javadoc>
  </target>
  
</project>
